<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body {
            margin-top: 50px;
            background-color: hsl(0, 0%, 10%);
            overflow: hidden;
        }

        input[type=button] {
            width: 100px;
            height: 30px;
            background-color: hsl(0, 0%, 60%);
            border: 0;
        }

        h5 {
            color: white;
            font-family: Arial, serif;
        }
    </style>
</head>
<body>
<div style="text-align: center;">
    <h5>
        Either watch this in "Full page" mode or minimize the editor to see the whole content
    </h5>
    <canvas id="canvas"></canvas>
    <br/>
    <br/>
    <input type="button" onclick="icosahedron.subdivide()" value="subdivide"/>
</div>

<script>
    function Vector3(x, y, z) {
        this.x = x;
        this.y = y;
        this.z = z;
    }

    Vector3.prototype.mag = function () {
        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);
    }

    Vector3.prototype.multiply = function (n) {
        this.x *= n;
        this.y *= n;
        this.z *= n;
        return this;
    }

    Vector3.prototype.normalize = function () {
        const n = this.mag()
        if (n !== 0) {
            this.multiply(1 / n);
        }
        return this;
    }

    function Triangle(pos1, pos2, pos3, color) {
        this.pos1 = pos1.normalize().multiply(150);
        this.pos2 = pos2.normalize().multiply(150);
        this.pos3 = pos3.normalize().multiply(150);
        this.color = color
    }

    Triangle.prototype.draw = function (ctx) {
        const color = "hsl(0, 0%, " + Math.floor(Math.random() * 100) + "%)";

        ctx.fillStyle = this.color;
        ctx.strokeStyle = this.color;
        ctx.beginPath();
        ctx.lineTo(this.pos1.x, this.pos1.y);
        ctx.lineTo(this.pos2.x, this.pos2.y);
        ctx.lineTo(this.pos3.x, this.pos3.y);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
    }

    Triangle.prototype.subdivide = function () {

        const v12 = new Vector3(0, 0, 0);
        const v23 = new Vector3(0, 0, 0);
        const v31 = new Vector3(0, 0, 0);

        v12['x'] = this.pos1['x'] + this.pos2['x'];
        v23['x'] = this.pos2['x'] + this.pos3['x'];
        v31['x'] = this.pos3['x'] + this.pos1['x'];

        v12['y'] = this.pos1['y'] + this.pos2['y'];
        v23['y'] = this.pos2['y'] + this.pos3['y'];
        v31['y'] = this.pos3['y'] + this.pos1['y'];

        v12['z'] = this.pos1['z'] + this.pos2['z'];
        v23['z'] = this.pos2['z'] + this.pos3['z'];
        v31['z'] = this.pos3['z'] + this.pos1['z'];


        return [
            new Triangle(this.pos1, v12, v31, 'red'),
            new Triangle(this.pos2, v23, v12, 'green'),
            new Triangle(this.pos3, v31, v23, 'blue'),
            new Triangle(v12, v23, v31, 'yellow')
        ];
    };

    const icosahedron = new function () {
        let c, ctx;
        const size = 500;
        let triangles = [];
        const X = 0.525731112119133606;
        const Z = 0.85065080835203993;
        const vertices = [
            [-X, 0.0, Z],
            [X, 0.0, Z],
            [-X, 0.0, -Z],
            [X, 0.0, -Z],
            [0.0, Z, X],
            [0.0, Z, -X],
            [0.0, -Z, X],
            [0.0, -Z, -X],
            [Z, X, 0.0],
            [-Z, X, 0.0],
            [Z, -X, 0.0],
            [-Z, -X, 0.0]
        ];
        const indices = [
            [0, 4, 1],
            [0, 9, 4],
            [9, 5, 4],
            [4, 5, 8],
            [4, 8, 1],
            [8, 10, 1],
            [8, 3, 10],
            [5, 3, 8],
            [5, 2, 3],
            [2, 7, 3],
            [7, 10, 3],
            [7, 6, 10],
            [7, 11, 6],
            [11, 0, 6],
            [0, 1, 6],
            [6, 1, 10],
            [9, 0, 11],
            [9, 11, 2],
            [9, 2, 5],
            [7, 2, 11]
        ];

        function main() {
            c = document.getElementById("canvas");
            c.width = size;
            c.height = size;
            ctx = c.getContext("2d");

            ctx.translate(size / 2, size / 2);

            for (let i = 0; i < indices.length; i++) {
                const ind = indices[i];
                triangles.push(new Triangle(
                    new Vector3(vertices[ind[0]][0], vertices[ind[0]][1], vertices[ind[0]][2]),
                    new Vector3(vertices[ind[1]][0], vertices[ind[1]][1], vertices[ind[1]][2]),
                    new Vector3(vertices[ind[2]][0], vertices[ind[2]][1], vertices[ind[2]][2]),
                    150
                ));
            }
            render()
        }

        function render() {
            ctx.clearRect(-size / 2, -size / 2, size, size);
            for (let i = 0; i < triangles.length; i++) {
                triangles[i].draw(ctx);
            }
        }

        this.subdivide = function () {
            let newTriangles = [];
            for (let i = 0; i < triangles.length; i++) {
                const a = triangles[i].subdivide()
                console.log(a)
                newTriangles = newTriangles.concat(a);
            }
            triangles = newTriangles;
            render()
        }

        main()
    }
</script>
</body>
</html>